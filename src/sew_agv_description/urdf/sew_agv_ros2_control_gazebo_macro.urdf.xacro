<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

    <xacro:macro name="sew_ros2_control_gazebo">

    <!--#######################################################################################################################################-->
    <!--set up the ros2 control plugin for the sew diff drive controller-->
    <!--#######################################################################################################################################-->
    <gazebo>
        <plugin filename="libgazebo_ros2_control.so" name="gazebo_ros2_control">
          <robot_param>robot_description</robot_param>
          <robot_param_node>robot_state_publisher</robot_param_node>
          <parameters>$(find sew_agv_drivers)/config/agv_controller.yaml</parameters>
          <controller_manager_name>controller_manager</controller_manager_name>
        </plugin>
    </gazebo>
    
    <!--#######################################################################################################################################-->
    <!--include lidar sensor simulation on lidar link -->
    <!--#######################################################################################################################################-->
        <gazebo reference="sew_lidar_link">
            <sensor type="ray" name="lidar_1">
                <pose> 0 0 0 0 0 0 </pose>      <!--define offset to lidar_link frame-->
                <visualize>true</visualize>
                <update_rate>10</update_rate>
                <ray>                               <!--define field of view-->
                    <scan>
                        <horizontal>
                            <samples>720</samples>
                            <min_angle>-2</min_angle>
                            <max_angle>2</max_angle>
                        </horizontal>
                    </scan>
                    <range>
                        <min>0.3</min>
                        <max>5</max>
                    </range>
                </ray>
                <plugin name="laser_controller" filename="libgazebo_ros_ray_sensor.so">     <!--call gazebo plugin for lidar-->
                    <ros>
                        <argument>~/out:=scan</argument>        <!--define output topic-->
                    </ros>
                    <output_type>sensor_msgs/LaserScan</output_type>
                    <frame_name>sew_lidar_link</frame_name>
                </plugin>
            </sensor>
        </gazebo>

    </xacro:macro>
</robot>